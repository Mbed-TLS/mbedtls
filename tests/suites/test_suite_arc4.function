/* BEGIN_HEADER */
#include "mbedtls/arc4.h"
/* END_HEADER */

/* BEGIN_DEPENDENCIES
 * depends_on:MBEDTLS_ARC4_C
 * END_DEPENDENCIES
 */

/* BEGIN_CASE depends_on:MBEDTLS_CHECK_PARAMS:!MBEDTLS_PARAM_FAILED_ALT */
void mbedtls_arc4_invalid_param( )
{
    mbedtls_arc4_context ctx;
    unsigned char key[128] = { 0 };

    TEST_VALID_PARAM( mbedtls_arc4_free( NULL ) );

    /* Check that parameter validation detect NULL parameters. */
    TEST_INVALID_PARAM( mbedtls_arc4_init( NULL ) );
    TEST_INVALID_PARAM( mbedtls_arc4_setup( NULL, key, sizeof( key ) ) );
    TEST_INVALID_PARAM( mbedtls_arc4_setup( &ctx, NULL, 42 ) );

    /* Check that parameter validation detects keys of invalid length. */
    TEST_INVALID_PARAM( mbedtls_arc4_setup( &ctx, key, 4 ) );
    TEST_INVALID_PARAM( mbedtls_arc4_setup( &ctx, key, 257 ) );

exit:
    return;
}
/* END_CASE */

/* BEGIN_CASE */
void mbedtls_arc4_crypt( data_t * src_str, data_t * key_str,
                         data_t * hex_dst_string )
{
    unsigned char dst_str[1000];
    mbedtls_arc4_context ctx;

    memset(dst_str, 0x00, 1000);
    mbedtls_arc4_init( &ctx );


    mbedtls_arc4_setup(&ctx, key_str->x, key_str->len);
    TEST_ASSERT( mbedtls_arc4_crypt(&ctx, src_str->len, src_str->x, dst_str ) == 0 );

    TEST_ASSERT( hexcmp( dst_str, hex_dst_string->x, src_str->len, hex_dst_string->len ) == 0 );

exit:
    mbedtls_arc4_free( &ctx );
}
/* END_CASE */

/* BEGIN_CASE depends_on:MBEDTLS_SELF_TEST */
void arc4_selftest(  )
{
    TEST_ASSERT( mbedtls_arc4_self_test( 1 ) == 0 );
}
/* END_CASE */
