/* BEGIN_HEADER */

#include <stdint.h>
#include <mbedtls/pk.h>

/* END_HEADER */

/* BEGIN_DEPENDENCIES
 * depends_on:MBEDTLS_PSA_CRYPTO_C
 * END_DEPENDENCIES
 */

/* BEGIN_CASE depends_on:MBEDTLS_PK_PARSE_C*/
void import_key_from_file(const char *path, int format_arg, int expected_status_arg)
{
    int ret;
    unsigned char *buf = NULL;
    size_t len;
    psa_status_t status;
    psa_status_t expected_status = (psa_status_t) expected_status_arg;
    psa_key_attributes_t attributes = PSA_KEY_ATTRIBUTES_INIT;
    psa_key_data_format_t format = format_arg;
    mbedtls_svc_key_id_t key = MBEDTLS_SVC_KEY_ID_INIT;

    PSA_ASSERT(psa_crypto_init());

    ret = mbedtls_pk_load_file(path, &buf, &len);
    TEST_EQUAL(ret, 0);

    status = psa_import_key_ext(&attributes, format, buf, len, &key);
    TEST_EQUAL(status, expected_status);

exit:
    mbedtls_free(buf);
    psa_destroy_key(key);
    PSA_DONE();
}
/* END_CASE */

/* BEGIN_CASE */
void import_encrypted_key_from_file(const char *path,
                                    int format_arg,
                                    char *secret,
                                    int expected_status_arg)
{
    (void) path;
    (void) format_arg;
    (void) secret;
    (void) expected_status_arg;

    PSA_ASSERT(psa_crypto_init());

exit:
    PSA_DONE();
}
/* END_CASE */

/* BEGIN_CASE */
void import_key_from_buf(data_t *buf, int format_arg, int expected_status_arg)
{
    psa_status_t status;
    psa_status_t expected_status = (psa_status_t) expected_status_arg;
    psa_key_attributes_t attributes = PSA_KEY_ATTRIBUTES_INIT;
    psa_key_data_format_t format = format_arg;
    mbedtls_svc_key_id_t key = MBEDTLS_SVC_KEY_ID_INIT;

    PSA_ASSERT(psa_crypto_init());

    status = psa_import_key_ext(&attributes, format, buf->x, buf->len, &key);
    TEST_EQUAL(status, expected_status);

exit:
    psa_destroy_key(key);
    PSA_DONE();
}
/* END_CASE */
